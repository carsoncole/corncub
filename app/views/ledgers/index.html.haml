.row
  .col-md-12
    .card
      .card-block
        .card-title
          %h4 Financial Ledger

        %ul.nav.nav-inline.small
          - if current_scout.is_financial_admin?
            %li.nav-item
              = link_to ledger_transactions_path, class: 'nav-link' do
                %i.fa.fa-plus.fa-lg
                New Transaction

          / %li.nav-item.dropdown
          /   = link_to "Bank Accounts", "#", class: 'nav-link dropdown-toggle', 'data-toggle': "dropdown"
          /   .dropdown-menu
          /     - @bank_accounts.each do |account|
          /       = link_to account.name, ledgers_path(account_id: account.id), class: 'dropdown-item'

        %br
        - total = 0
        %table.table.table-sm.small
          %thead
            %tr
              %th Account
              %th Description
              %th Amount
              %th Date
              %th
              %th Stock
              %th Created
              %th DE ID
              %th

          %tbody
            - @ledgers.each do |ledger|
              %tr
                %td= link_to ledger.account.name, ledgers_path(account_id: ledger.account_id)
                %td= ledger.description
                %td
                  = number_to_currency(ledger.amount)
                  - total += ledger.amount
                %td= nice_date_less(ledger.date) if ledger.date
                %td
                  - if ledger.take_order_id
                    =link_to "Take Order", take_order_path(ledger.take_order_id)
                  - elsif ledger.site_sale_id
                    =link_to "Site Sale", site_sale_path(ledger.site_sale_id)
                %td
                  - if ledger.stock_id && ledger.stock
                    = link_to ledger.stock.product.name, stock_path(ledger.stock_id)
                %td= nice_date_time_compact(ledger.created_at)
                %td= ledger.double_entry_id
                %td
                  = link_to ledger_path(ledger) do
                    %i.fa.fa-folder-open.fa-lg
                  - unless ledger.stock_id || !current_scout.is_financial_admin?
                    = link_to edit_ledger_path(ledger) do
                      %i.fa.fa-pencil.fa-lg
                  
                    = link_to ledger, :method => :delete, :data => { :confirm => 'Destroying a transaction will also destroy any related double-entry transactions (sharing the same double-entry ID)' } do
                      %i.fa.fa-trash.fa-lg

            %tr
              %td
              %td
              %td= number_to_currency(total, precision: 2)
              %td
              %td
              %td
              %td
              %td
              %td
        = paginate @ledgers
.row
  .col-md-12
    .card
      .card-block
        .card-title
          %h2 Financial Ledger

        %ul.nav.nav-inline
          - if current_scout.is_financial_admin?
            %li.nav-item
              = link_to new_ledger_path, class: 'nav-link' do
                %i.fa.fa-plus.fa-lg
          - if current_scout.is_financial_admin?
            %li.nav-item
              = link_to "Transactions", ledger_transactions_path, class: 'nav-link'
          - if current_scout.is_financial_admin? || current_scout.is_site_sales_admin? || current_scout.is_take_orders_admin?
            %li.nav-item
              = link_to bank_deposit_path, class: 'nav-link' do
                Bank Deposit
          - if current_scout.is_take_orders_admin?
            %li.nav-item
              = link_to new_ledger_path(collect_from_customer: true), class: 'nav-link' do
                Collect fr/Customer
          %li.nav-item.dropdown
            = link_to "Bank Accounts", "#", class: 'nav-link dropdown-toggle', 'data-toggle': "dropdown"
            .dropdown-menu
              - @bank_accounts.each do |account|
                = link_to account.name, ledgers_path(account_id: account.id), class: 'dropdown-item'

        %br
        - total = 0
        %table.table.table-sm
          %thead
            %tr
              %th Account
              %th Description
              %th Amount
              %th Date
              %th Created
              %th
              %th Stock
              %th

          %tbody
            - @ledgers.each do |ledger|
              %tr
                %td= link_to ledger.account.name, ledgers_path(account_id: ledger.account_id)
                %td= ledger.description
                %td
                  = number_to_currency(ledger.amount)
                  - total += ledger.amount
                %td= nice_date_less(ledger.date) if ledger.date
                %td= nice_date_time_compact(ledger.created_at)
                %td
                  - if ledger.take_order_id
                    =link_to "Take Order", take_order_path(ledger.take_order_id)
                  - elsif ledger.site_sale_id
                    =link_to "Site Sale", site_sale_path(ledger.site_sale_id)
                %td
                  - if ledger.stock_id && ledger.stock
                    = link_to ledger.stock.product.name, stock_path(ledger.stock_id)
                %td
                  = link_to ledger_path(ledger) do
                    %i.fa.fa-folder-open.fa-lg
                  - unless ledger.stock_id || !current_scout.is_financial_admin?
                    = link_to edit_ledger_path(ledger) do
                      %i.fa.fa-pencil.fa-lg
                  
                    = link_to ledger, :method => :delete do
                      %i.fa.fa-trash.fa-lg
            %tr
              %td
              %td
              %td= number_to_currency(total, precision: 2)
              %td
              %td
              %td
              %td
              %td
        = paginate @ledgers
%h3
  = @unit.name
  = "-"
  = @active_event.name
  Take Orders Order

%table.table.table-sm
  %tr
    %th Product
    %th Orders
    %th Inventory
    %th Order
    %th Price
    %th Amount
  - @grand_total = 0
  - @products_to_order.each do |product_id, quantity|
    - product = @active_event.products.find(product_id)
    - next unless product.is_sourced_from_bsa
    %tr
      %td= product.name
      %td= quantity
      %td
        - inventory = product.stocks.sum(:quantity)
        = inventory
      %td
        - order_quantity = quantity - inventory
        - order_quantity = 0 if order_quantity < 0
        = order_quantity
      %td= number_to_currency(product.retail_price)
      %td
        = number_to_currency(order_quantity * product.retail_price)
        - @grand_total += order_quantity * product.retail_price

  %tr
    %td(colspan=5)
    %td= number_to_currency(@grand_total)

%p= nice_date_time(Time.now)